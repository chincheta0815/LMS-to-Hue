[% extJsScripts = BLOCK %]
    <script TYPE="text/javascript">
        Ext.onReady(function(){
            new Ext.util.TaskRunner().start({
                run: function(items){
                    SqueezeJS.Controller.request({
                        params: [ '', [ "hue", "bridge", "connect", "progress" ] ],
                        
                        success: function(response) {
                            response = Ext.util.JSON.decode(response.responseText);
                            if (response && response.result) {
                                items.each(function(item) {
                                
                                    var connectProgressValue = response.result['_hueBridgeConnectProgress'];
                                
                                    if ( connectProgressValue != -1.0 ) {
                                        if ( connectProgressValue > 0.00 ) {
                                            item.dom.disabled = true;
                                        
                                            Ext.MessageBox.show({
                                                title: "[% 'PLUGIN_HUEBRIDGE_MESSAGEBOX_CONNECT_TITLE' | string %]",
                                                msg: "<p style='text-align:center;'>[% 'PLUGIN_HUEBRIDGE_MESSAGEBOX_CONNECT_MSG' | string %]</p><img src='/plugins/HueBridge/html/images/pushlink_bridgev2.png' style='display:block; margin-left:auto; margin-right:auto; width:150px; height:auto;'>",
                                                progressText: '',
                                                width: 300,
                                                progress: true,
                                                closable: false,
                                                buttons: Ext.MessageBox.CANCEL,
                                                fn: function(btn, text) {
                                                    SqueezeJS.Controller.request({
                                                        params: [ '', [ "hue", "bridge", "connect", "cancel" ] ],
                        
                                                        success: function(response) {
                                                            response = Ext.util.JSON.decode(response.responseText);
                                                            if ( response && response.result ) {
                                                                if ( response.result['_hueBridgeConnectCancel'] == 1) {
                                                                    Ext.MessageBox.hide();
                                                                }
                                                            }
                                                        }
                                                    })
                                                }
                                            });
                                        
                                            if ( connectProgressValue < 1.00 ) {
                                                Ext.MessageBox.updateProgress(connectProgressValue, 'Waiting ...');
                                            }
                                        }
                                        else {
                                            item.dom.disabled = false;
                                            Ext.MessageBox.hide()
                                        }
                                    }
                                });
                            }
                        }
                    })
                    Ext.Ajax.request({
                        url: 'plugins/HueBridge/settings/tableAdvancedHueBridgeOptions.html',
                        
                        success: function(response) {
                            Ext.get('tableAdvancedHueBridgeOptions').update(response.responseText);
                        }
                    })
                    Ext.Ajax.request({
                        url: 'plugins/HueBridge/settings/tableHueBridges.html',
                        
                        success: function(response) {
                            Ext.get('tableHueBridges').update(response.responseText);
                        }
                    })
                },
                args: [ Ext.select('.disableOnHueBridgePairing') ],
                interval: 2000
            });
        });
    </script>
[% END %]
[% PROCESS settings/header.html %]

    [% YESNOBOX = [['',''], ['yes','1'], ['no','0']] %]

	[% WRAPPER setting title="PLUGIN_HUEBRIDGE_NAME" desc="" %]
		<div class="groupDesc">[% "PLUGIN_HUEBRIDGE_DESC" | string %]</div>
	[% END %]

    <style>
        .x-progress-bar { background: #008d89#; }
        .x-progress-text { color: #008d89; }
    </style>

    [% WRAPPER setting title="PLUGIN_HUEBRIDGE_GENERAL_SETTINGS_NAME" desc="PLUGIN_HUEBRIDGE_GENERAL_SETTINGS_DESC" %]
        <table border="0" cellspacing="0">
            <tr>
                <td class="[% odd ? "odd" : "even" %]" colspan="4">[% 'PLUGIN_HUEBRIDGE_BINARY_AUTORUN_NAME' | string %]&nbsp;&nbsp;&nbsp;</td>
                <td class="[% odd ? "odd" : "even" %]" colspan="4"><input name="binaryAutorun" type="checkbox" class="stdedit disableOnHueBridgePairing" [% IF prefs.pref_binaryAutorun %] checked="1" [% END %] [% IF status_hueBridgeConnect %]disabled[% END %]></td>
            </tr>
            <tr>
                <td class="[% odd ? "odd" : "even" %]" colspan="4">[% 'PLUGIN_HUEBRIDGE_BINARY_SELECTED_NAME' | string %]&nbsp;&nbsp;&nbsp;</td>
            	<td class="[% odd ? "odd" : "even" %]" colspan="4">
                    [% IF availableHelperBinaries.size > 1 %]
                    <select class="stdedit disableOnHueBridgePairing" name="pref_helperBinary" id="helperBinary">
                        [% FOREACH entry IN availableHelperBinaries %]
                            <option [% IF entry == helperBinary %]selected[% found = 1 %][% END %] [% IF status_hueBridgeConnect %]disabled[% END %] value="[% entry %]">[% entry %]</option>
                        [% END %]
                        [% IF not found %]
                            <option selected value="">[% 'PLUGIN_HUEBRIDGE_BINARY_SELECT_MENU_NAME' | string %]</option>
                        [% END %]
                    </select>
                [% END %]
                </td>
            </tr>
        </table>
    [% END %]
    [% WRAPPER setting title="PLUGIN_HUEBRIDGE_ADVANCED_OPTIONS_NAME" desc="PLUGIN_HUEBRIDGE_ADVANCED_OPTIONS_DESC" %]
        <table border="0" cellspacing="0">
            <tr>
                <td class="[% odd ? "odd" : "even" %]" colspan="4">
                    [% 'PLUGIN_HUEBRIDGE_SHOW_ADVANCED_OPTIONS_NAME' | string %]&nbsp;&nbsp;&nbsp;
                </td>
                <td class="[% odd ? "odd" : "even" %]" colspan="4" align="center">
                    <input type="checkbox" [% IF prefs.pref_showAdvancedHueBridgeOptions %] checked="1" [% END %] class="stdedit disableOnHueBridgePairing" [% IF status_hueBridgeConnect %]disabled[% END %] name="pref_showAdvancedHueBridgeOptions" id="showAdvancedHueBridgeOptions" value="1">
                </td>
            </tr>
            <tr id="tableAdvancedHueBridgeOptions"></tr>
        </table>
    [% END %]

    [% WRAPPER setting title="PLUGIN_HUEBRIDGE_LIST_NAME" desc="PLUGIN_HUEBRIDGE_LIST_DESC" %]
        <table id="tableHueBridges"></table>
    [% END %]

[% PROCESS settings/footer.html %]
